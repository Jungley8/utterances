{"mappings":"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","sources":["src/repo-regex.ts","src/page-attributes.ts","src/utterances-api.ts","src/oauth.ts","src/github.ts","src/encoding.ts","src/time-ago.ts","src/measure.ts","src/reactions.ts","src/comment-component.ts","src/timeline-component.ts","src/repo-config.ts","src/new-comment-component.ts","src/utterances.ts","src/theme.ts"],"sourcesContent":["export default /^([\\w-_]+)\\/([\\w-_.]+)$/i;\n","import repoRegex from './repo-regex';\n\nfunction readPageAttributes() {\n  const params = Object.fromEntries(new URL(location.href).searchParams)\n\n  let issueTerm: string | null = null;\n  let issueNumber: number | null = null;\n  if ('issue-term' in params) {\n    issueTerm = params['issue-term'];\n    if (issueTerm !== undefined) {\n      if (issueTerm === '') {\n        throw new Error('When issue-term is specified, it cannot be blank.');\n      }\n      if (['title', 'url', 'pathname', 'og:title'].indexOf(issueTerm) !== -1) {\n        if (!params[issueTerm]) {\n          throw new Error(`Unable to find \"${issueTerm}\" metadata.`);\n        }\n        issueTerm = params[issueTerm];\n      }\n    }\n  } else if ('issue-number' in params) {\n    issueNumber = +params['issue-number'];\n    if (issueNumber.toString(10) !== params['issue-number']) {\n      throw new Error(`issue-number is invalid. \"${params['issue-number']}`);\n    }\n  } else {\n    throw new Error('\"issue-term\" or \"issue-number\" must be specified.');\n  }\n\n  if (!('repo' in params)) {\n    throw new Error('\"repo\" is required.');\n  }\n\n  if (!('origin' in params)) {\n    throw new Error('\"origin\" is required.');\n  }\n\n  const matches = repoRegex.exec(params.repo);\n  if (matches === null) {\n    throw new Error(`Invalid repo: \"${params.repo}\"`);\n  }\n\n  return {\n    owner: matches[1],\n    repo: matches[2],\n    issueTerm,\n    issueNumber,\n    origin: params.origin,\n    url: params.url,\n    title: params.title,\n    description: params.description,\n    label: params.label,\n    theme: params.theme || 'github-light',\n    session: params.session\n  };\n}\n\nexport const pageAttributes = readPageAttributes();\n","// export const UTTERANCES_API = 'http://localhost:7000';\nexport const UTTERANCES_API = \"https://utterances-oauth.jungley.workers.dev\";\n","import { UTTERANCES_API } from './utterances-api';\nimport { pageAttributes } from './page-attributes';\n\nexport const token = { value: null as null | string };\n\n// tslint:disable-next-line:variable-name\nexport function getLoginUrl(redirect_uri: string) {\n  return `${UTTERANCES_API}/authorize?${new URLSearchParams({ redirect_uri })}`;\n}\n\nexport async function loadToken(): Promise<string | null> {\n  if (token.value) {\n    return token.value;\n  }\n  if (!pageAttributes.session) {\n    return null;\n  }\n  const url = `${UTTERANCES_API}/token`;\n  const response = await fetch(url, {\n    method: 'POST',\n    mode: 'cors',\n    credentials: 'include',\n    headers: {\n      'content-type': 'application/json'\n    },\n    body: JSON.stringify(pageAttributes.session)\n  });\n  if (response.ok) {\n    const t = await response.json();\n    token.value = t;\n    return t;\n  }\n  return null;\n}\n","import { token } from './oauth';\nimport { decodeBase64UTF8 } from './encoding';\nimport { UTTERANCES_API } from './utterances-api';\n\nconst GITHUB_API = 'https://api.github.com/';\nconst GITHUB_ENCODING__HTML_JSON = 'application/vnd.github.VERSION.html+json';\nconst GITHUB_ENCODING__HTML = 'application/vnd.github.VERSION.html';\nconst GITHUB_ENCODING__REST_V3 = 'application/vnd.github.v3+json';\n\nexport const PAGE_SIZE = 25;\n\nexport type ReactionID = '+1' | '-1' | 'laugh' | 'hooray' | 'confused' | 'heart' | 'rocket' | 'eyes';\n\nexport const reactionTypes: ReactionID[] = ['+1', '-1', 'laugh', 'hooray', 'confused', 'heart', 'rocket', 'eyes'];\n\nlet owner: string;\nlet repo: string;\nconst branch = 'master';\n\nexport function setRepoContext(context: { owner: string; repo: string; }) {\n  owner = context.owner;\n  repo = context.repo;\n}\n\nfunction githubRequest(relativeUrl: string, init?: RequestInit) {\n  init = init || {};\n  init.mode = 'cors';\n  init.cache = 'no-cache'; // force conditional request\n  const request = new Request(GITHUB_API + relativeUrl, init);\n  request.headers.set('Accept', GITHUB_ENCODING__REST_V3);\n  if (token.value !== null) {\n    request.headers.set('Authorization', `token ${token.value}`);\n  }\n  return request;\n}\n\nconst rateLimit = {\n  standard: {\n    limit: Number.MAX_VALUE,\n    remaining: Number.MAX_VALUE,\n    reset: 0\n  },\n  search: {\n    limit: Number.MAX_VALUE,\n    remaining: Number.MAX_VALUE,\n    reset: 0\n  }\n};\n\nfunction processRateLimit(response: Response) {\n  const limit = response.headers.get('X-RateLimit-Limit')!;\n  const remaining = response.headers.get('X-RateLimit-Remaining')!;\n  const reset = response.headers.get('X-RateLimit-Reset')!;\n\n  const isSearch = /\\/search\\//.test(response.url);\n  const rate = isSearch ? rateLimit.search : rateLimit.standard;\n\n  rate.limit = +limit;\n  rate.remaining = +remaining;\n  rate.reset = +reset;\n\n  if (response.status === 403 && rate.remaining === 0) {\n    const resetDate = new Date(0);\n    resetDate.setUTCSeconds(rate.reset);\n    const mins = Math.round((resetDate.getTime() - new Date().getTime()) / 1000 / 60);\n    const apiType = isSearch ? 'search API' : 'non-search APIs';\n    // tslint:disable-next-line:no-console\n    console.warn(`Rate limit exceeded for ${apiType}. Resets in ${mins} minute${mins === 1 ? '' : 's'}.`);\n  }\n}\n\nexport function readRelNext(response: Response) {\n  const link = response.headers.get('link');\n  if (link === null) {\n    return 0;\n  }\n  const match = /\\?page=([2-9][0-9]*)>; rel=\"next\"/.exec(link);\n  if (match === null) {\n    return 0;\n  }\n  return +match[1];\n}\n\nfunction githubFetch(request: Request): Promise<Response> {\n  return fetch(request).then(response => {\n    if (response.status === 401) {\n      token.value = null;\n    }\n    if (response.status === 403) {\n      response.json().then(data => {\n        if (data.message === 'Resource not accessible by integration') {\n          window.dispatchEvent(new CustomEvent('not-installed'));\n        }\n      });\n    }\n\n    processRateLimit(response);\n\n    if (request.method === 'GET'\n      && [401, 403].indexOf(response.status) !== -1\n      && request.headers.has('Authorization')\n    ) {\n      request.headers.delete('Authorization');\n      return githubFetch(request);\n    }\n    return response;\n  });\n}\n\nexport function loadJsonFile<T>(path: string, html = false) {\n  const request = githubRequest(`repos/${owner}/${repo}/contents/${path}?ref=${branch}`);\n  if (html) {\n    request.headers.set('accept', GITHUB_ENCODING__HTML);\n  }\n  return githubFetch(request).then<FileContentsResponse | string>(response => {\n    if (response.status === 404) {\n      throw new Error(`Repo \"${owner}/${repo}\" does not have a file named \"${path}\" in the \"${branch}\" branch.`);\n    }\n    if (!response.ok) {\n      throw new Error(`Error fetching ${path}.`);\n    }\n    return html ? response.text() : response.json();\n  }).then<T>(file => {\n    if (html) {\n      return file;\n    }\n    const { content } = file as FileContentsResponse;\n    const decoded = decodeBase64UTF8(content);\n    return JSON.parse(decoded);\n  });\n}\n\nexport function loadIssueByTerm(term: string) {\n  const q = `\"${term}\" type:issue in:title repo:${owner}/${repo}`;\n  const request = githubRequest(`search/issues?q=${encodeURIComponent(q)}&sort=created&order=asc`);\n  return githubFetch(request).then<IssueSearchResponse>(response => {\n    if (!response.ok) {\n      throw new Error('Error fetching issue via search.');\n    }\n    return response.json();\n  }).then(results => {\n    if (results.total_count === 0) {\n      return null;\n    }\n    if (results.total_count > 1) {\n      // tslint:disable-next-line:no-console\n      console.warn(`Multiple issues match \"${q}\".`);\n    }\n    term = term.toLowerCase();\n    for (const result of results.items) {\n      if (result.title.toLowerCase().indexOf(term) !== -1) {\n        return result;\n      }\n    }\n    // tslint:disable-next-line:no-console\n    console.warn(`Issue search results do not contain an issue with title matching \"${term}\". Using first result.`);\n    return results.items[0];\n  });\n}\n\nexport function loadIssueByNumber(issueNumber: number) {\n  const request = githubRequest(`repos/${owner}/${repo}/issues/${issueNumber}`);\n  return githubFetch(request).then<Issue>(response => {\n    if (!response.ok) {\n      throw new Error('Error fetching issue via issue number.');\n    }\n    return response.json();\n  });\n}\n\nfunction commentsRequest(issueNumber: number, page: number) {\n  const url = `repos/${owner}/${repo}/issues/${issueNumber}/comments?page=${page}&per_page=${PAGE_SIZE}`;\n  const request = githubRequest(url);\n  const accept = `${GITHUB_ENCODING__HTML_JSON},${GITHUB_ENCODING__REST_V3}`;\n  request.headers.set('Accept', accept);\n  return request;\n}\n\nexport function loadCommentsPage(issueNumber: number, page: number): Promise<IssueComment[]> {\n  const request = commentsRequest(issueNumber, page);\n  return githubFetch(request).then(response => {\n    if (!response.ok) {\n      throw new Error('Error fetching comments.');\n    }\n    return response.json();\n  });\n}\n\nexport function loadUser(): Promise<User | null> {\n  if (token.value === null) {\n    return Promise.resolve(null);\n  }\n  return githubFetch(githubRequest('user'))\n    .then(response => {\n      if (response.ok) {\n        return response.json();\n      }\n      return null;\n    });\n}\n\nexport function createIssue(issueTerm: string, documentUrl: string, title: string, description: string, label: string) {\n  const url = `${UTTERANCES_API}/repos/${owner}/${repo}/issues${label ? `?label=${encodeURIComponent(label)}` : ''}`;\n  const request = new Request(url, {\n    method: 'POST',\n    body: JSON.stringify({\n      title: issueTerm,\n      body: `# ${title}\\n\\n${description}\\n\\n[${documentUrl}](${documentUrl})`\n    })\n  });\n  request.headers.set('Accept', GITHUB_ENCODING__REST_V3);\n  request.headers.set('Authorization', `token ${token.value}`);\n  return fetch(request).then<Issue>(response => {\n    if (!response.ok) {\n      throw new Error('Error creating comments container issue');\n    }\n    return response.json();\n  });\n}\n\nexport function postComment(issueNumber: number, markdown: string) {\n  const url = `repos/${owner}/${repo}/issues/${issueNumber}/comments`;\n  const body = JSON.stringify({ body: markdown });\n  const request = githubRequest(url, { method: 'POST', body });\n  const accept = `${GITHUB_ENCODING__HTML_JSON},${GITHUB_ENCODING__REST_V3}`;\n  request.headers.set('Accept', accept);\n  return githubFetch(request).then<IssueComment>(response => {\n    if (!response.ok) {\n      throw new Error('Error posting comment.');\n    }\n    return response.json();\n  });\n}\n\nexport async function toggleReaction(url: string, content: ReactionID) {\n  url = url.replace(GITHUB_API, '');\n  // We don't know if the reaction exists or not. Attempt to create it. If the GitHub\n  // API responds that the reaction already exists, delete it.\n  const body = JSON.stringify({ content });\n  const postRequest = githubRequest(url, { method: 'POST', body });\n  postRequest.headers.set('Accept', GITHUB_ENCODING__REST_V3);\n  const response = await githubFetch(postRequest);\n  const reaction: Reaction = response.ok ? await response.json() : null;\n  if (response.status === 201) { // reaction created.\n    return { reaction, deleted: false };\n  }\n  if (response.status !== 200) {\n    throw new Error('expected \"201 reaction created\" or \"200 reaction already exists\"');\n  }\n  // reaction already exists... delete.\n  const deleteRequest = githubRequest(`${url}/${reaction.id}`, { method: 'DELETE' });\n  deleteRequest.headers.set('Accept', GITHUB_ENCODING__REST_V3);\n  await githubFetch(deleteRequest);\n  return { reaction, deleted: true };\n}\n\nexport function renderMarkdown(text: string) {\n  const body = JSON.stringify({ text, mode: 'gfm', context: `${owner}/${repo}` });\n  return githubFetch(githubRequest('markdown', { method: 'POST', body }))\n    .then(response => response.text());\n}\n\ninterface IssueSearchResponse {\n  total_count: number;\n  incomplete_results: boolean;\n  items: Issue[];\n}\n\nexport interface User {\n  login: string;\n  id: number;\n  avatar_url: string;\n  gravatar_id: string;\n  url: string;\n  html_url: string;\n  followers_url: string;\n  following_url: string;\n  gists_url: string;\n  starred_url: string;\n  subscriptions_url: string;\n  organizations_url: string;\n  repos_url: string;\n  events_url: string;\n  received_events_url: string;\n  type: string;\n}\n\nexport type CommentAuthorAssociation =\n  'COLLABORATOR'\n  | 'CONTRIBUTOR'\n  | 'FIRST_TIMER'\n  | 'FIRST_TIME_CONTRIBUTOR'\n  | 'MEMBER'\n  | 'NONE'\n  | 'OWNER';\n\nexport interface Reactions {\n  url: string;\n  total_count: number;\n  '+1': number;\n  '-1': number;\n  laugh: number;\n  hooray: number;\n  confused: number;\n  heart: number;\n  rocket: number;\n  eyes: number;\n}\n\nexport interface Reaction {\n  id: number;\n  user: User;\n  content: ReactionID;\n  created_at: string;\n}\n\nexport interface Issue {\n  url: string;\n  repository_url: string;\n  labels_url: string;\n  comments_url: string;\n  events_url: string;\n  html_url: string;\n  id: number;\n  number: number;\n  title: string;\n  user: User;\n  locked: boolean;\n  labels: {\n    url: string;\n    name: string;\n    color: string;\n  }[];\n  state: string;\n  assignee: null; // todo,\n  milestone: null; // todo,\n  comments: number;\n  created_at: string;\n  updated_at: string;\n  closed_at: null; // todo,\n  pull_request: {\n    html_url: null; // todo,\n    diff_url: null; // todo,\n    patch_url: null; // todo\n  };\n  body: string;\n  score: number;\n  reactions: Reactions;\n  author_association: CommentAuthorAssociation;\n}\n\ninterface FileContentsResponse {\n  type: string;\n  encoding: string;\n  size: number;\n  name: string;\n  path: string;\n  content: string;\n  sha: string;\n  url: string;\n  git_url: string;\n  html_url: string;\n  download_url: string;\n}\n\nexport interface IssueComment {\n  id: number;\n  url: string;\n  html_url: string;\n  body_html: string;\n  user: User;\n  created_at: string;\n  updated_at: string;\n  author_association: CommentAuthorAssociation;\n  reactions: Reactions;\n}\n\n/*\nquery IssueComments($owner: String!, $repo: String!, $issueQuery: String!) {\n  search(query: $issueQuery, type: ISSUE, first: 1) {\n    issueCount\n    edges {\n      node {\n        ... on Issue {\n          id\n          title,\n          comments(first: 100) {\n          \ttotalCount\n            edges {\n              node {\n                id,\n                createdAt,\n                bodyHTML,\n                author {\n                  avatarUrl,\n                  login\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  }\n\n  rateLimit {\n    cost\n    limit\n    remaining\n    resetAt\n  }\n\n  repository(owner: $owner, name: $repo) {\n    object(expression: \"master:utterances.json\") {\n      ... on Blob {\n        text\n      }\n    }\n  }\n}\n\n{\n  \"issueQuery\": \"user:jdanyow repo:utterances-demo debug\",\n  \"owner\": \"jdanyow\",\n  \"repo\": \"utterances-demo\"\n}\n*/\n","declare function escape(str: string): string;\n\nexport function decodeBase64UTF8(encoded: string) {\n  encoded = encoded.replace(/\\s/g, '');\n  return decodeURIComponent(escape(atob(encoded)));\n}\n","// todo: take a dependency on some relative time library.\n\nconst thresholds = [\n  1000, 'second',\n  1000 * 60, 'minute',\n  1000 * 60 * 60, 'hour',\n  1000 * 60 * 60 * 24, 'day',\n  1000 * 60 * 60 * 24 * 7, 'week',\n  1000 * 60 * 60 * 24 * 27, 'month'\n];\n\nconst formatOptions: Intl.DateTimeFormatOptions = { month: 'short', day: 'numeric', year: 'numeric' };\n\nexport function timeAgo(current: number, value: Date) {\n  const elapsed = current - value.getTime();\n  if (elapsed < 5000) {\n    return 'just now';\n  }\n  let i = 0;\n  while (i + 2 < thresholds.length && elapsed * 1.1 > thresholds[i + 2]) {\n    i += 2;\n  }\n\n  const divisor = thresholds[i] as number;\n  const text = thresholds[i + 1] as string;\n  const units = Math.round(elapsed / divisor);\n\n  if (units > 3 && i === thresholds.length - 2) {\n    return `on ${value.toLocaleDateString(undefined, formatOptions)}`;\n  }\n  return units === 1 ? `${text === 'hour' ? 'an' : 'a'} ${text} ago` : `${units} ${text}s ago`;\n}\n","export interface ResizeMessage {\n  type: 'resize';\n  height: number;\n}\n\nlet hostOrigin: string;\n\nexport function startMeasuring(origin: string) {\n  hostOrigin = origin;\n  addEventListener('resize', scheduleMeasure);\n  addEventListener('load', scheduleMeasure);\n}\n\nlet lastHeight = -1;\n\nfunction measure() {\n  const height = document.body.scrollHeight;\n  if (height === lastHeight) {\n    return;\n  }\n  lastHeight = height;\n  const message: ResizeMessage = { type: 'resize', height };\n  parent.postMessage(message, hostOrigin);\n}\n\nlet lastMeasure = 0;\n\nexport function scheduleMeasure() {\n  const now = Date.now();\n  if (now - lastMeasure > 50) {\n    lastMeasure = now;\n    setTimeout(measure, 50);\n  }\n}\n","import { toggleReaction, ReactionID, reactionTypes } from './github';\nimport { getLoginUrl } from './oauth';\nimport { pageAttributes } from './page-attributes';\nimport { scheduleMeasure } from './measure';\n\nexport const reactionNames: Record<ReactionID, string> = {\n  '+1': 'Thumbs Up',\n  '-1': 'Thumbs Down',\n  'laugh': 'Laugh',\n  'hooray': 'Hooray',\n  'confused': 'Confused',\n  'heart': 'Heart',\n  'rocket': 'Rocket',\n  'eyes': 'Eyes'\n};\n\nexport const reactionEmoji: Record<ReactionID, string> = {\n  '+1': 'üëç',\n  '-1': 'üëé',\n  'laugh': 'Ô∏èüòÇ',\n  'hooray': 'Ô∏èüéâ',\n  'confused': 'üòï',\n  'heart': '‚ù§Ô∏è',\n  'rocket': 'üöÄ',\n  'eyes': 'üëÄ'\n};\n\nexport function getReactionHtml(url: string, reaction: ReactionID, disabled: boolean, count: number) {\n  return `\n  <button\n    reaction\n    type=\"submit\"\n    action=\"javascript:\"\n    formaction=\"${url}\"\n    class=\"btn BtnGroup-item reaction-button\"\n    value=\"${reaction}\"\n    aria-label=\"Toggle ${reactionNames[reaction]} reaction\"\n    reaction-count=\"${count}\"\n    ${disabled ? 'disabled' : ''}>\n    ${reactionEmoji[reaction]}\n  </button>`;\n}\n\nexport function enableReactions(authenticated: boolean) {\n  const submitReaction = async (event: Event) => {\n    const button = event.target instanceof HTMLElement && event.target.closest('button');\n    if (!button) {\n      return;\n    }\n    if (!button.hasAttribute('reaction')) {\n      return;\n    }\n    event.preventDefault();\n    if (!authenticated) {\n      return;\n    }\n    button.disabled = true;\n    const parentMenu = button.closest('details');\n    if (parentMenu) {\n      parentMenu.open = false;\n    }\n    const url = button.formAction;\n    const id = button.value as ReactionID;\n    const { deleted } = await toggleReaction(url, id);\n    const selector = `button[reaction][formaction=\"${url}\"][value=\"${id}\"],[reaction-count][reaction-url=\"${url}\"]`;\n    const elements = Array.from(document.querySelectorAll(selector));\n    const delta = deleted ? -1 : 1;\n    for (const element of elements) {\n      element.setAttribute(\n        'reaction-count',\n        (parseInt(element.getAttribute('reaction-count')!, 10) + delta).toString());\n    }\n    button.disabled = false;\n    scheduleMeasure();\n  };\n  addEventListener('click', submitReaction, true);\n}\n\nexport function getReactionsMenuHtml(url: string, align: 'center' | 'right') {\n  const position = align === 'center' ? 'left: 50%;transform: translateX(-50%)' : 'right:6px';\n  const alignmentClass = align === 'center' ? '' : 'Popover-message--top-right';\n  const getButtonAndSpan = (id: ReactionID) => getReactionHtml(url, id, false, 0)\n    + `<span class=\"reaction-name\" aria-hidden=\"true\">${reactionNames[id]}</span>`;\n  return `\n  <details class=\"details-overlay details-popover reactions-popover\">\n    <summary ${align === 'center' ? 'tabindex=\"-1\"' : ''}>${addReactionSvgs}</summary>\n    <div class=\"Popover\" style=\"${position}\">\n      <form class=\"Popover-message ${alignmentClass} box-shadow-large\" action=\"javascript:\">\n        <span class=\"reaction-name\">Pick your reaction</span>\n        <div class=\"BtnGroup\">\n          ${reactionTypes.slice(0, 4).map(getButtonAndSpan).join('')}\n        </div>\n        <div class=\"BtnGroup\">\n          ${reactionTypes.slice(4).map(getButtonAndSpan).join('')}\n        </div>\n      </form>\n    </div>\n  </details>`;\n}\n\nexport function getSignInToReactMenuHtml(align: 'center' | 'right') {\n  const position = align === 'center' ? 'left: 50%;transform: translateX(-50%)' : 'right:6px';\n  const alignmentClass = align === 'center' ? '' : 'Popover-message--top-right';\n  return `\n  <details class=\"details-overlay details-popover reactions-popover\">\n    <summary aria-label=\"Reactions Menu\">${addReactionSvgs}</summary>\n    <div class=\"Popover\" style=\"${position}\">\n      <div class=\"Popover-message ${alignmentClass} box-shadow-large\" style=\"padding: 16px\">\n        <span><a href=\"${getLoginUrl(pageAttributes.url)}\" target=\"_top\">Sign in</a> to add your reaction.</span>\n      </div>\n    </div>\n  </details>`;\n}\n\n// tslint:disable-next-line:max-line-length\nconst addReactionSvgs = `<svg class=\"octicon\" style=\"margin-right:3px\" viewBox=\"0 0 7 16\" version=\"1.1\" width=\"7\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M4 4H3v3H0v1h3v3h1V8h3V7H4V4z\"></path></svg><svg class=\"octicon\" viewBox=\"0 0 16 16\" version=\"1.1\" width=\"16\" height=\"16\" aria-hidden=\"true\"><path fill-rule=\"evenodd\" d=\"M8 0C3.58 0 0 3.58 0 8s3.58 8 8 8 8-3.58 8-8-3.58-8-8-8zm4.81 12.81a6.72 6.72 0 0 1-2.17 1.45c-.83.36-1.72.53-2.64.53-.92 0-1.81-.17-2.64-.53-.81-.34-1.55-.83-2.17-1.45a6.773 6.773 0 0 1-1.45-2.17A6.59 6.59 0 0 1 1.21 8c0-.92.17-1.81.53-2.64.34-.81.83-1.55 1.45-2.17.62-.62 1.36-1.11 2.17-1.45A6.59 6.59 0 0 1 8 1.21c.92 0 1.81.17 2.64.53.81.34 1.55.83 2.17 1.45.62.62 1.11 1.36 1.45 2.17.36.83.53 1.72.53 2.64 0 .92-.17 1.81-.53 2.64-.34.81-.83 1.55-1.45 2.17zM4 6.8v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2H5.2C4.53 8 4 7.47 4 6.8zm5 0v-.59c0-.66.53-1.19 1.2-1.19h.59c.66 0 1.19.53 1.19 1.19v.59c0 .67-.53 1.2-1.19 1.2h-.59C9.53 8 9 7.47 9 6.8zm4 3.2c-.72 1.88-2.91 3-5 3s-4.28-1.13-5-3c-.14-.39.23-1 .66-1h8.59c.41 0 .89.61.75 1z\"></path></svg>`;\n","import { CommentAuthorAssociation, IssueComment, reactionTypes } from './github';\nimport { timeAgo } from './time-ago';\nimport { scheduleMeasure } from './measure';\nimport { getReactionsMenuHtml, getReactionHtml, getSignInToReactMenuHtml } from './reactions';\n\nconst avatarArgs = '?v=3&s=88';\nconst displayAssociations: Record<CommentAuthorAssociation, string> = {\n  COLLABORATOR: 'Collaborator',\n  CONTRIBUTOR: 'Contributor',\n  MEMBER: 'Member',\n  OWNER: 'Owner',\n  FIRST_TIME_CONTRIBUTOR: 'First time contributor',\n  FIRST_TIMER: 'First timer',\n  NONE: ''\n};\n\nexport class CommentComponent {\n  public readonly element: HTMLElement;\n\n  constructor(\n    public comment: IssueComment,\n    private currentUser: string | null,\n    locked: boolean\n  ) {\n    const { user, html_url, created_at, body_html, author_association, reactions } = comment;\n    this.element = document.createElement('article');\n    this.element.classList.add('timeline-comment');\n    if (user.login === currentUser) {\n      this.element.classList.add('current-user');\n    }\n    const association = displayAssociations[author_association];\n    const reactionCount = reactionTypes.reduce((sum, id) => sum + reactions[id], 0);\n    let headerReactionsMenu = '';\n    let footerReactionsMenu = '';\n    if (!locked) {\n      if (currentUser) {\n        headerReactionsMenu = getReactionsMenuHtml(comment.reactions.url, 'right');\n        footerReactionsMenu = getReactionsMenuHtml(comment.reactions.url, 'center');\n      } else {\n        headerReactionsMenu = getSignInToReactMenuHtml('right');\n        footerReactionsMenu = getSignInToReactMenuHtml('center');\n      }\n    }\n    this.element.innerHTML = `\n      <a class=\"avatar\" href=\"${user.html_url}\" target=\"_blank\" tabindex=\"-1\">\n        <img alt=\"@${user.login}\" height=\"44\" width=\"44\"\n              src=\"${user.avatar_url}${avatarArgs}\">\n      </a>\n      <div class=\"comment\">\n        <header class=\"comment-header\">\n          <span class=\"comment-meta\">\n            <a class=\"text-link\" href=\"${user.html_url}\" target=\"_blank\"><strong>${user.login}</strong></a>\n            commented\n            <a class=\"text-link\" href=\"${html_url}\" target=\"_blank\">${timeAgo(Date.now(), new Date(created_at))}</a>\n          </span>\n          <div class=\"comment-actions\">\n            ${association ? `<span class=\"author-association-badge\">${association}</span>` : ''}\n            ${headerReactionsMenu}\n          </div>\n        </header>\n        <div class=\"markdown-body markdown-body-scrollable\">\n          ${body_html}\n        </div>\n        <div class=\"comment-footer\" reaction-count=\"${reactionCount}\" reaction-url=\"${reactions.url}\">\n          <form class=\"reaction-list BtnGroup\" action=\"javascript:\">\n            ${reactionTypes.map(id => getReactionHtml(reactions.url, id, !currentUser || locked, reactions[id])).join('')}\n          </form>\n          ${footerReactionsMenu}\n        </div>\n      </div>`;\n\n    const markdownBody = this.element.querySelector('.markdown-body')!;\n    const emailToggle = markdownBody.querySelector('.email-hidden-toggle a') as HTMLAnchorElement;\n    if (emailToggle) {\n      const emailReply = markdownBody.querySelector('.email-hidden-reply') as HTMLDivElement;\n      emailToggle.onclick = event => {\n        event.preventDefault();\n        emailReply.classList.toggle('expanded');\n      };\n    }\n\n    processRenderedMarkdown(markdownBody);\n  }\n\n  public setCurrentUser(currentUser: string | null) {\n    if (this.currentUser === currentUser) {\n      return;\n    }\n    this.currentUser = currentUser;\n\n    if (this.comment.user.login === this.currentUser) {\n      this.element.classList.add('current-user');\n    } else {\n      this.element.classList.remove('current-user');\n    }\n  }\n}\n\nexport function processRenderedMarkdown(markdownBody: Element) {\n  Array.from(markdownBody.querySelectorAll<HTMLAnchorElement>(':not(.email-hidden-toggle) > a'))\n    .forEach(a => { a.target = '_top'; a.rel = 'noopener noreferrer'; });\n  Array.from(markdownBody.querySelectorAll<HTMLImageElement>('img'))\n    .forEach(img => img.onload = scheduleMeasure);\n  Array.from(markdownBody.querySelectorAll<HTMLAnchorElement>('a.commit-tease-sha'))\n    .forEach(a => a.href = 'https://github.com' + a.pathname);\n}\n","import { User, Issue, IssueComment } from './github';\nimport { CommentComponent } from './comment-component';\nimport { scheduleMeasure } from './measure';\n\nexport class TimelineComponent {\n  public readonly element: HTMLElement;\n  private readonly timeline: CommentComponent[] = [];\n  private readonly countAnchor: HTMLAnchorElement;\n  private readonly marker: Node;\n  private count: number = 0;\n\n  constructor(\n    private user: User | null,\n    private issue: Issue | null\n  ) {\n    this.element = document.createElement('main');\n    this.element.classList.add('timeline');\n    this.element.innerHTML = `\n      <h1 class=\"timeline-header\">\n        <a class=\"text-link\" target=\"_blank\"></a>\n        <em>\n          - powered by\n          <a class=\"text-link\" href=\"https://utteranc.es\" target=\"_blank\">utteranc.es</a>\n        </em>\n      </h1>`;\n    this.countAnchor = this.element.firstElementChild!.firstElementChild as HTMLAnchorElement;\n    this.marker = document.createComment('marker');\n    this.element.appendChild(this.marker);\n    this.setIssue(this.issue);\n    this.renderCount();\n  }\n\n  public setUser(user: User | null) {\n    this.user = user;\n    const login = user ? user.login : null;\n    for (let i = 0; i < this.timeline.length; i++) {\n      this.timeline[i].setCurrentUser(login);\n    }\n    scheduleMeasure();\n  }\n\n  public setIssue(issue: Issue | null) {\n    this.issue = issue;\n    if (issue) {\n      this.count = issue.comments;\n      this.countAnchor.href = issue.html_url;\n      this.renderCount();\n    } else {\n      this.countAnchor.removeAttribute('href');\n    }\n  }\n\n  public insertComment(comment: IssueComment, incrementCount: boolean) {\n    const component = new CommentComponent(\n      comment,\n      this.user ? this.user.login : null,\n      this.issue!.locked);\n\n    const index = this.timeline.findIndex(x => x.comment.id >= comment.id);\n    if (index === -1) {\n      this.timeline.push(component);\n      this.element.insertBefore(component.element, this.marker);\n    } else {\n      const next = this.timeline[index];\n      const remove = next.comment.id === comment.id;\n      this.element.insertBefore(component.element, next.element);\n      this.timeline.splice(index, remove ? 1 : 0, component);\n      if (remove) {\n        next.element.remove();\n      }\n    }\n\n    if (incrementCount) {\n      this.count++;\n      this.renderCount();\n    }\n\n    scheduleMeasure();\n  }\n\n  public insertPageLoader(insertAfter: IssueComment, count: number, callback: () => void) {\n    const { element: insertAfterElement } = this.timeline.find(x => x.comment.id >= insertAfter.id)!;\n    insertAfterElement.insertAdjacentHTML('afterend', `\n      <div class=\"page-loader\">\n        <div class=\"zigzag\"></div>\n        <button type=\"button\" class=\"btn btn-outline btn-large\">\n          ${count} hidden items<br/>\n          <span>Load more...</span>\n        </button>\n      </div>\n    `);\n    const element = insertAfterElement.nextElementSibling!;\n    const button = element.lastElementChild! as HTMLButtonElement;\n    const statusSpan = button.lastElementChild!;\n    button.onclick = callback;\n\n    return {\n      setBusy() {\n        statusSpan.textContent = 'Loading...';\n        button.disabled = true;\n      },\n      remove() {\n        button.onclick = null;\n        element.remove();\n      }\n    };\n  }\n\n  private renderCount() {\n    this.countAnchor.textContent = `${this.count} Comment${this.count === 1 ? '' : 's'}`;\n  }\n}\n","import { loadJsonFile } from './github';\nimport { pageAttributes } from './page-attributes';\n\nexport interface RepoConfig {\n  origins: string[];\n}\n\nlet promise: Promise<RepoConfig>;\n\nexport function getRepoConfig() {\n  if (!promise) {\n    promise = loadJsonFile<RepoConfig>('utterances.json').then(\n      data => {\n        if (!Array.isArray(data.origins)) {\n          data.origins = [];\n        }\n        return data;\n      },\n      () => ({\n        origins: [pageAttributes.origin]\n      })\n    );\n  }\n\n  return promise;\n}\n","import { pageAttributes as page } from './page-attributes';\nimport { User, renderMarkdown } from './github';\nimport { scheduleMeasure } from './measure';\nimport { processRenderedMarkdown } from './comment-component';\nimport { getRepoConfig } from './repo-config';\nimport { getLoginUrl } from './oauth';\n\n// tslint:disable-next-line:max-line-length\nconst anonymousAvatar = `<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 14 16\" version=\"1.1\"><path fill=\"rgb(179,179,179)\" fill-rule=\"evenodd\" d=\"M8 10.5L9 14H5l1-3.5L5.25 9h3.5L8 10.5zM10 6H4L2 7h10l-2-1zM9 2L7 3 5 2 4 5h6L9 2zm4.03 7.75L10 9l1 2-2 3h3.22c.45 0 .86-.31.97-.75l.56-2.28c.14-.53-.19-1.08-.72-1.22zM4 9l-3.03.75c-.53.14-.86.69-.72 1.22l.56 2.28c.11.44.52.75.97.75H5l-2-3 1-2z\"></path></svg>`;\n// base64 encoding works in IE, Edge. UTF-8 does not.\nconst anonymousAvatarUrl = `data:image/svg+xml;base64,${btoa(anonymousAvatar)}`;\n\nconst nothingToPreview = 'Nothing to preview';\n\nexport class NewCommentComponent {\n  public readonly element: HTMLElement;\n\n  private avatarAnchor: HTMLAnchorElement;\n  private avatar: HTMLImageElement;\n  private form: HTMLFormElement;\n  private textarea: HTMLTextAreaElement;\n  private preview: HTMLDivElement;\n  private submitButton: HTMLButtonElement;\n  private signInAnchor: HTMLAnchorElement;\n\n  private submitting = false;\n  private renderTimeout = 0;\n\n  constructor(\n    private user: User | null,\n    private readonly submit: (markdown: string) => Promise<void>\n  ) {\n    this.element = document.createElement('article');\n    this.element.classList.add('timeline-comment');\n\n    this.element.innerHTML = `\n      <a class=\"avatar\" target=\"_blank\" tabindex=\"-1\">\n        <img height=\"44\" width=\"44\">\n      </a>\n      <form class=\"comment\" accept-charset=\"UTF-8\" action=\"javascript:\">\n        <header class=\"new-comment-header tabnav\">\n          <div class=\"tabnav-tabs\" role=\"tablist\">\n            <button type=\"button\" class=\"tabnav-tab tab-write\"\n                    role=\"tab\" aria-selected=\"true\">\n              Write\n            </button>\n            <button type=\"button\" class=\"tabnav-tab tab-preview\"\n                    role=\"tab\">\n              Preview\n            </button>\n          </div>\n        </header>\n        <div class=\"comment-body\">\n          <textarea class=\"form-control\" placeholder=\"Leave a comment\" aria-label=\"comment\"></textarea>\n          <div class=\"markdown-body\" style=\"display: none\">\n            ${nothingToPreview}\n          </div>\n        </div>\n        <footer class=\"new-comment-footer\">\n          <a class=\"text-link markdown-info\" tabindex=\"-1\" target=\"_blank\"\n             href=\"https://guides.github.com/features/mastering-markdown/\">\n            <svg class=\"octicon v-align-bottom\" viewBox=\"0 0 16 16\" version=\"1.1\"\n              width=\"16\" height=\"16\" aria-hidden=\"true\">\n              <path fill-rule=\"evenodd\" d=\"M14.85 3H1.15C.52 3 0 3.52 0 4.15v7.69C0 12.48.52 13 1.15\n                13h13.69c.64 0 1.15-.52 1.15-1.15v-7.7C16 3.52 15.48 3 14.85 3zM9 11H7V8L5.5 9.92 4\n                8v3H2V5h2l1.5 2L7 5h2v6zm2.99.5L9.5 8H11V5h2v3h1.5l-2.51 3.5z\">\n              </path>\n            </svg>\n            Styling with Markdown is supported\n          </a>\n          <button class=\"btn btn-primary\" type=\"submit\">Comment</button>\n          <a class=\"btn btn-primary\" href=\"${getLoginUrl(page.url)}\" target=\"_top\">\n            <svg class=\"octicon\" aria-hidden=\"true\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\" width=\"16\" height=\"16\"><path fill-rule=\"evenodd\" d=\"M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z\"></path></svg>\n            Sign in with GitHub\n          </a>\n        </footer>\n      </form>`;\n\n    this.avatarAnchor = this.element.firstElementChild as HTMLAnchorElement;\n    this.avatar = this.avatarAnchor.firstElementChild as HTMLImageElement;\n    this.form = this.avatarAnchor.nextElementSibling as HTMLFormElement;\n    this.textarea = this.form!.firstElementChild!.nextElementSibling!.firstElementChild as HTMLTextAreaElement;\n    this.preview = this.form!.firstElementChild!.nextElementSibling!.lastElementChild as HTMLDivElement;\n    this.signInAnchor = this.form!.lastElementChild!.lastElementChild! as HTMLAnchorElement;\n    this.submitButton = this.signInAnchor.previousElementSibling! as HTMLButtonElement;\n\n    this.setUser(user);\n    this.submitButton.disabled = true;\n\n    this.textarea.addEventListener('input', this.handleInput);\n    this.form.addEventListener('submit', this.handleSubmit);\n    this.form.addEventListener('click', this.handleClick);\n    this.form.addEventListener('keydown', this.handleKeyDown);\n    handleTextAreaResize(this.textarea);\n  }\n\n  public setUser(user: User | null) {\n    this.user = user;\n    this.submitButton.hidden = !user;\n    this.signInAnchor.hidden = !!user;\n    if (user) {\n      this.avatarAnchor.href = user.html_url;\n      this.avatar.alt = '@' + user.login;\n      this.avatar.src = user.avatar_url + '?v=3&s=88';\n      this.textarea.disabled = false;\n      this.textarea.placeholder = 'Leave a comment';\n    } else {\n      this.avatarAnchor.removeAttribute('href');\n      this.avatar.alt = '@anonymous';\n      this.avatar.src = anonymousAvatarUrl;\n      this.textarea.disabled = true;\n      this.textarea.placeholder = 'Sign in to comment';\n    }\n  }\n\n  public clear() {\n    this.textarea.value = '';\n  }\n\n  private handleInput = () => {\n    getRepoConfig(); // preload repo config\n    const text = this.textarea.value;\n    const isWhitespace = /^\\s*$/.test(text);\n    this.submitButton.disabled = isWhitespace;\n    if (this.textarea.scrollHeight < 450 && this.textarea.offsetHeight < this.textarea.scrollHeight) {\n      this.textarea.style.height = `${this.textarea.scrollHeight}px`;\n      scheduleMeasure();\n    }\n\n    clearTimeout(this.renderTimeout);\n    if (isWhitespace) {\n      this.preview.textContent = nothingToPreview;\n    } else {\n      this.preview.textContent = 'Loading preview...';\n      this.renderTimeout = setTimeout(\n        () => renderMarkdown(text).then(html => this.preview.innerHTML = html)\n          .then(() => processRenderedMarkdown(this.preview))\n          .then(scheduleMeasure),\n        500);\n    }\n  }\n\n  private handleSubmit = async (event: Event) => {\n    event.preventDefault();\n    if (this.submitting) {\n      return;\n    }\n    this.submitting = true;\n    this.textarea.disabled = true;\n    this.submitButton.disabled = true;\n    await this.submit(this.textarea.value).catch(() => 0);\n    this.submitting = false;\n    this.textarea.disabled = !this.user;\n    this.textarea.value = '';\n    this.submitButton.disabled = false;\n    this.handleClick({ ...event, target: this.form.querySelector('.tabnav-tab.tab-write') });\n    this.preview.textContent = nothingToPreview;\n  }\n\n  private handleClick = ({ target }: Event) => {\n    if (!(target instanceof HTMLButtonElement) || !target.classList.contains('tabnav-tab')) {\n      return;\n    }\n    if (target.getAttribute('aria-selected') === 'true') {\n      return;\n    }\n    this.form.querySelector('.tabnav-tab[aria-selected=\"true\"]')!.setAttribute('aria-selected', 'false');\n    target.setAttribute('aria-selected', 'true');\n    const isPreview = target.classList.contains('tab-preview');\n    this.textarea.style.display = isPreview ? 'none' : '';\n    this.preview.style.display = isPreview ? '' : 'none';\n    scheduleMeasure();\n  }\n\n  private handleKeyDown = ({ which, ctrlKey }: KeyboardEvent) => {\n    if (which === 13 && ctrlKey && !this.submitButton.disabled) {\n      this.form.dispatchEvent(new CustomEvent('submit'));\n    }\n  }\n}\n\nfunction handleTextAreaResize(textarea: HTMLTextAreaElement) {\n  const stopTracking = () => {\n    removeEventListener('mousemove', scheduleMeasure);\n    removeEventListener('mouseup', stopTracking);\n  };\n  const track = () => {\n    addEventListener('mousemove', scheduleMeasure);\n    addEventListener('mouseup', stopTracking);\n  };\n  textarea.addEventListener('mousedown', track);\n}\n","import { pageAttributes as page } from './page-attributes';\nimport {\n  Issue,\n  setRepoContext,\n  loadIssueByTerm,\n  loadIssueByNumber,\n  loadCommentsPage,\n  loadUser,\n  postComment,\n  createIssue,\n  PAGE_SIZE,\n  IssueComment\n} from './github';\nimport { TimelineComponent } from './timeline-component';\nimport { NewCommentComponent } from './new-comment-component';\nimport { startMeasuring, scheduleMeasure } from './measure';\nimport { loadTheme } from './theme';\nimport { getRepoConfig } from './repo-config';\nimport { loadToken } from './oauth';\nimport { enableReactions } from './reactions';\n\nsetRepoContext(page);\n\nfunction loadIssue(): Promise<Issue | null> {\n  if (page.issueNumber !== null) {\n    return loadIssueByNumber(page.issueNumber);\n  }\n  return loadIssueByTerm(page.issueTerm as string);\n}\n\nasync function bootstrap() {\n  await loadToken();\n  // tslint:disable-next-line:prefer-const\n  let [issue, user] = await Promise.all([\n    loadIssue(),\n    loadUser(),\n    loadTheme(page.theme, page.origin)\n  ]);\n\n  startMeasuring(page.origin);\n\n  const timeline = new TimelineComponent(user, issue);\n  document.body.appendChild(timeline.element);\n\n  if (issue && issue.comments > 0) {\n    renderComments(issue, timeline);\n  }\n\n  scheduleMeasure();\n\n  if (issue && issue.locked) {\n    return;\n  }\n\n  enableReactions(!!user);\n\n  const submit = async (markdown: string) => {\n    await assertOrigin();\n    if (!issue) {\n      issue = await createIssue(\n        page.issueTerm as string,\n        page.url,\n        page.title,\n        page.description || '',\n        page.label\n      );\n      timeline.setIssue(issue);\n    }\n    const comment = await postComment(issue.number, markdown);\n    timeline.insertComment(comment, true);\n    newCommentComponent.clear();\n  };\n\n  const newCommentComponent = new NewCommentComponent(user, submit);\n  timeline.element.appendChild(newCommentComponent.element);\n}\n\nbootstrap();\n\naddEventListener('not-installed', function handleNotInstalled() {\n  removeEventListener('not-installed', handleNotInstalled);\n  document.querySelector('.timeline')!.insertAdjacentHTML('afterbegin', `\n  <div class=\"flash flash-error\">\n    Error: utterances is not installed on <code>${page.owner}/${page.repo}</code>.\n    If you own this repo,\n    <a href=\"https://github.com/apps/utterances\" target=\"_top\"><strong>install the app</strong></a>.\n    Read more about this change in\n    <a href=\"https://github.com/utterance/utterances/pull/25\" target=\"_top\">the PR</a>.\n  </div>`);\n  scheduleMeasure();\n});\n\nasync function renderComments(issue: Issue, timeline: TimelineComponent) {\n  const renderPage = (page: IssueComment[]) => {\n    for (const comment of page) {\n      timeline.insertComment(comment, false);\n    }\n  };\n\n  const pageCount = Math.ceil(issue.comments / PAGE_SIZE);\n  // always load the first page.\n  const pageLoads = [loadCommentsPage(issue.number, 1)];\n  // if there are multiple pages, load the last page.\n  if (pageCount > 1) {\n    pageLoads.push(loadCommentsPage(issue.number, pageCount));\n  }\n  // if the last page is small, load the penultimate page.\n  if (pageCount > 2 && issue.comments % PAGE_SIZE < 3 &&\n    issue.comments % PAGE_SIZE !== 0) {\n    pageLoads.push(loadCommentsPage(issue.number, pageCount - 1));\n  }\n  // await all loads to reduce jank.\n  const pages = await Promise.all(pageLoads);\n  for (const page of pages) {\n    renderPage(page);\n  }\n  // enable loading hidden pages.\n  let hiddenPageCount = pageCount - pageLoads.length;\n  let nextHiddenPage = 2;\n  const renderLoader = (afterPage: IssueComment[]) => {\n    if (hiddenPageCount === 0) {\n      return;\n    }\n    const load = async () => {\n      loader.setBusy();\n      const page = await loadCommentsPage(issue.number, nextHiddenPage);\n      loader.remove();\n      renderPage(page);\n      hiddenPageCount--;\n      nextHiddenPage++;\n      renderLoader(page);\n    };\n    const afterComment = afterPage.pop()!;\n    const loader = timeline.insertPageLoader(afterComment, hiddenPageCount * PAGE_SIZE, load);\n  };\n  renderLoader(pages[0]);\n}\n\nexport async function assertOrigin() {\n  const { origins } = await getRepoConfig();\n  const { origin, owner, repo } = page;\n  if (origins.indexOf(origin) !== -1) {\n    return;\n  }\n\n  document.querySelector('.timeline')!.lastElementChild!.insertAdjacentHTML('beforebegin', `\n  <div class=\"flash flash-error flash-not-installed\">\n    Error: <code>${origin}</code> is not permitted to post to <code>${owner}/${repo}</code>.\n    Confirm this is the correct repo for this site's comments. If you own this repo,\n    <a href=\"https://github.com/${owner}/${repo}/edit/master/utterances.json\" target=\"_top\">\n      <strong>update the utterances.json</strong>\n    </a>\n    to include <code>${origin}</code> in the list of origins.<br/><br/>\n    Suggested configuration:<br/>\n    <pre><code>${JSON.stringify({ origins: [origin] }, null, 2)}</code></pre>\n  </div>`);\n  scheduleMeasure();\n  throw new Error('Origin not permitted.');\n}\n","export function loadTheme(theme: string, origin: string) {\n  return new Promise(resolve => {\n    const link = document.createElement('link');\n    link.rel = 'stylesheet';\n    link.setAttribute('crossorigin', 'anonymous');\n    link.onload = resolve;\n    link.href = `/stylesheets/themes/${theme}/utterances.css`;\n    document.head.appendChild(link);\n\n    addEventListener('message', event => {\n      if (event.origin === origin && event.data.type === 'set-theme') {\n        link.href = `/stylesheets/themes/${event.data.theme}/utterances.css`;\n      }\n    });\n  });\n}\n"],"names":["$193e5960ae26d54e$export$2e2bcd8739ae039","$200f111eee9332a5$export$39e9d7d26d319f3f","params","Object","fromEntries","URL","location","href","searchParams","issueTerm","issueNumber","undefined","Error","indexOf","toString","matches","exec","repo","owner","origin","url","title","description","label","theme","session","$200f111eee9332a5$var$readPageAttributes","$b42c611a49ad29a3$export$bebb1ad02def6380","$23dd512f46da709b$export$9e1725a4cfeada27","value","$23dd512f46da709b$export$8abe2e83e8d74da2","redirect_uri","URLSearchParams","async","$23dd512f46da709b$export$1718d02e8422300d","response","fetch","method","mode","credentials","headers","body","JSON","stringify","ok","t","json","$f74139262f7ae290$var$GITHUB_API","$f74139262f7ae290$var$GITHUB_ENCODING__HTML_JSON","$f74139262f7ae290$var$GITHUB_ENCODING__HTML","$f74139262f7ae290$var$GITHUB_ENCODING__REST_V3","$f74139262f7ae290$export$8ec3d08588d2eeda","$f74139262f7ae290$export$f1cecf0348ad61b6","$f74139262f7ae290$var$owner","$f74139262f7ae290$var$repo","$f74139262f7ae290$var$branch","$f74139262f7ae290$var$githubRequest","relativeUrl","init","cache","request","Request","set","$f74139262f7ae290$var$rateLimit","standard","limit","Number","MAX_VALUE","remaining","reset","search","$f74139262f7ae290$var$githubFetch","then","status","data","message","window","dispatchEvent","CustomEvent","get","isSearch","test","rate","resetDate","Date","setUTCSeconds","mins","Math","round","getTime","apiType","console","warn","$f74139262f7ae290$var$processRateLimit","has","delete","$f74139262f7ae290$export$7baf800005eaa4c0","path","html","text","file","content","decoded","encoded","replace","decodeURIComponent","escape","atob","parse","$f74139262f7ae290$export$4fa9ff7efbbceac8","term","q","encodeURIComponent","results","total_count","toLowerCase","result","items","$f74139262f7ae290$export$68cefc586a750a6b","page","accept","$f74139262f7ae290$var$commentsRequest","$f74139262f7ae290$export$b61347e00e271b8e","documentUrl","$f74139262f7ae290$export$b8fc62ea9b811d23","markdown","$f74139262f7ae290$export$fb8a5038533fa3c3","postRequest","reaction","deleted","deleteRequest","id","$f74139262f7ae290$export$bd27f0c8b4b4eabc","context","$a9bb21873adffc79$var$thresholds","$a9bb21873adffc79$var$formatOptions","month","day","year","$a9bb21873adffc79$export$9b9f695373d1284f","current","elapsed","i","length","divisor","units","toLocaleDateString","$2c33eae1c7881364$var$hostOrigin","$2c33eae1c7881364$export$b17e2cc3f671c526","addEventListener","$2c33eae1c7881364$export$7c323c751be4880a","$2c33eae1c7881364$var$lastHeight","$2c33eae1c7881364$var$measure","height","document","scrollHeight","type","parent","postMessage","$2c33eae1c7881364$var$lastMeasure","now","setTimeout","$50c5f5c56427cfc4$export$2931de0fdf77d5e","laugh","hooray","confused","heart","rocket","eyes","$50c5f5c56427cfc4$export$ac57cce825598c92","$50c5f5c56427cfc4$export$22e2166b890946d6","disabled","count","$50c5f5c56427cfc4$export$d1201d356f452a8e","authenticated","event","button","target","HTMLElement","closest","hasAttribute","preventDefault","parentMenu","open","formAction","selector","elements","Array","from","querySelectorAll","delta","element","setAttribute","parseInt","getAttribute","$50c5f5c56427cfc4$export$efa098611fe361f5","align","getButtonAndSpan","$50c5f5c56427cfc4$var$addReactionSvgs","slice","map","join","$50c5f5c56427cfc4$export$677f52c83daec619","$b2f9b299aaf349dc$var$displayAssociations","COLLABORATOR","CONTRIBUTOR","MEMBER","OWNER","FIRST_TIME_CONTRIBUTOR","FIRST_TIMER","NONE","$b2f9b299aaf349dc$export$411f863b9eac311c","constructor","comment","currentUser","locked","this","user","html_url","created_at","body_html","author_association","reactions","createElement","classList","add","login","association","reactionCount","reduce","sum","headerReactionsMenu","footerReactionsMenu","innerHTML","avatar_url","markdownBody","querySelector","emailToggle","emailReply","onclick","toggle","$b2f9b299aaf349dc$export$52ef2d3be4093295","setCurrentUser","remove","forEach","a","rel","img","onload","pathname","$34ddfc2d8bee04e7$export$49f98cb065d4337b","issue","timeline","countAnchor","firstElementChild","marker","createComment","appendChild","setIssue","renderCount","setUser","comments","removeAttribute","insertComment","incrementCount","component","index","findIndex","x","push","insertBefore","next","splice","insertPageLoader","insertAfter","callback","insertAfterElement","find","insertAdjacentHTML","nextElementSibling","lastElementChild","statusSpan","setBusy","textContent","$9271376a7a58cb8a$var$promise","$9271376a7a58cb8a$export$2e3e298f0f7179f9","isArray","origins","$ebae68f1a0d2ef9a$var$anonymousAvatarUrl","btoa","$ebae68f1a0d2ef9a$var$nothingToPreview","$ebae68f1a0d2ef9a$export$8640408e5353c7f0","submit","submitting","renderTimeout","handleInput","textarea","isWhitespace","submitButton","offsetHeight","style","clearTimeout","preview","handleSubmit","catch","handleClick","form","HTMLButtonElement","contains","isPreview","display","handleKeyDown","which","ctrlKey","avatarAnchor","avatar","signInAnchor","previousElementSibling","stopTracking","removeEventListener","track","$ebae68f1a0d2ef9a$var$handleTextAreaResize","hidden","alt","src","placeholder","clear","$1ab099ecf2ee7553$var$loadIssue","Promise","all","resolve","link","head","renderPage","pageCount","ceil","pageLoads","number","pages","hiddenPageCount","nextHiddenPage","renderLoader","afterPage","load","loader","afterComment","pop","$1ab099ecf2ee7553$var$renderComments","newCommentComponent","$1ab099ecf2ee7553$export$1b23ea1ac569cd25","$1ab099ecf2ee7553$var$bootstrap","handleNotInstalled"],"version":3,"file":"utterances.ac911a00.js.map"}