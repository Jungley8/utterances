{"mappings":"MAAO,MAAMA,EAAiBC,OAAOC,WAAW,gCAAgCC,QAC5E,cACA,eCCEC,EAAM,IAAIC,IAAIC,SAASC,MAEvBC,EAAUJ,EAAIK,aAAaC,IAAI,cACjCF,IACFG,aAAaC,QAAQ,qBAAsBJ,GAC3CJ,EAAIK,aAAaI,OAAO,cACxBC,QAAQC,kBAAaC,EAAWC,SAASC,MAAOd,EAAIG,OAGtD,IAAIY,EAASF,SAASG,mBACPJ,IAAXG,IAGFA,EAASF,SAASI,cAChB,kHAKJ,MAAMC,EAAgC,GACtC,IAAK,IAAIC,EAAI,EAAGA,EAAIJ,EAAOK,WAAWC,OAAQF,IAAK,CACjD,MAAMG,EAAYP,EAAOK,WAAWG,KAAKJ,GACzCD,EAAMI,EAAUE,KAAKC,QAAQ,SAAU,KAAOH,EAAUI,KACzD,CDtB+B,2BCuB5BR,EAAMS,QACRT,EAAMS,MAAQ/B,GAIhB,MAAMgC,EAAgBf,SAASI,cAC7B,yBAEFC,EAAMW,IAAMD,EACRA,EAAczB,KACdH,EAAI8B,OAAS9B,EAAI+B,SAAW/B,EAAIgC,OACpCd,EAAMY,OAAS9B,EAAI8B,OACnBZ,EAAMa,SACJ/B,EAAI+B,SAASV,OAAS,EAClB,QACArB,EAAI+B,SAASE,OAAO,GAAGR,QAAQ,SAAU,IAC/CP,EAAMJ,MAAQD,SAASC,MACvB,MAAMoB,EAAkBrB,SAASI,cAC/B,4BAEFC,EAAMiB,YAAcD,EAAkBA,EAAgBE,QAAU,GAEhE,MAAMC,EAAMC,mBAAmBpB,EAAMiB,aAAad,OAC9CgB,EAAM,MACRnB,EAAMiB,YAAcjB,EAAMiB,YAAYF,OACpC,EACAM,KAAKC,MAAkC,IAA5BtB,EAAOiB,YAAYd,OAAiBgB,KAGnD,MAAMI,EAAc5B,SAASI,cAC3B,mDAEFC,EAAM,YAAcuB,EAAcA,EAAYL,QAAU,GACxDlB,EAAMwB,QAAUtC,GAAWG,aAAaoC,QAAQ,uBAAyB,GAKzE9B,SAAS+B,KAAKC,mBACZ,aACA,+aAwBF,MAAMC,EAAmB/B,EAAOgC,IAAIC,MAClC,uEACC,GACHC,QAAQC,IAAI,C,iBAAEJ,IACd,MAAMK,EAAW,GAAGL,oBACpB/B,EAAO8B,mBACL,WACA,uGAC0EM,KAAY,IAAIC,gBACxFlC,0CAIJ,MAAMmC,EAAYtC,EAAOuC,mBACzBvC,EAAOwC,cAAeC,YAAYzC,GAGlC0C,iBAAiB,WAAYC,IAI3B,MAAMC,EAAOD,EAAMC,KACfA,GAAsB,WAAdA,EAAKC,MAAqBD,EAAKE,SACzCR,EAAUS,MAAMD,OAAS,GAAGF,EAAKE,WAAU,G","sources":["src/preferred-theme.ts","src/client.ts"],"sourcesContent":["export const preferredTheme = window.matchMedia('(prefers-color-scheme: dark)').matches\n  ? 'github-dark'\n  : 'github-light';\n\nexport const preferredThemeId = 'preferred-color-scheme';","import { ResizeMessage } from \"./measure\";\nimport { preferredThemeId, preferredTheme } from \"./preferred-theme\";\n\nconst url = new URL(location.href);\n// slice session from query string\nconst session = url.searchParams.get(\"utterances\");\nif (session) {\n  localStorage.setItem(\"utterances-session\", session);\n  url.searchParams.delete(\"utterances\");\n  history.replaceState(undefined, document.title, url.href);\n}\n\nlet script = document.currentScript as HTMLScriptElement;\nif (script === undefined) {\n  // Internet Explorer :(\n  // tslint:disable-next-line:max-line-length\n  script = document.querySelector(\n    'script[src^=\"https://jungley8.github.io/utterances/client.js\"],script[src^=\"http://localhost:4000/client.js\"]'\n  ) as HTMLScriptElement;\n}\n\n// gather script element's attributes\nconst attrs: Record<string, string> = {};\nfor (let i = 0; i < script.attributes.length; i++) {\n  const attribute = script.attributes.item(i)!;\n  attrs[attribute.name.replace(/^data-/, \"\")] = attribute.value; // permit using data-theme instead of theme.\n}\nif (attrs.theme === preferredThemeId) {\n  attrs.theme = preferredTheme;\n}\n\n// gather page attributes\nconst canonicalLink = document.querySelector(\n  `link[rel='canonical']`\n) as HTMLLinkElement;\nattrs.url = canonicalLink\n  ? canonicalLink.href\n  : url.origin + url.pathname + url.search;\nattrs.origin = url.origin;\nattrs.pathname =\n  url.pathname.length < 2\n    ? \"index\"\n    : url.pathname.substr(1).replace(/\\.\\w+$/, \"\");\nattrs.title = document.title;\nconst descriptionMeta = document.querySelector(\n  `meta[name='description']`\n) as HTMLMetaElement;\nattrs.description = descriptionMeta ? descriptionMeta.content : \"\";\n// truncate descriptions that would trigger 414 \"URI Too Long\"\nconst len = encodeURIComponent(attrs.description).length;\nif (len > 1000) {\n  attrs.description = attrs.description.substr(\n    0,\n    Math.floor((attrs.description.length * 1000) / len)\n  );\n}\nconst ogtitleMeta = document.querySelector(\n  `meta[property='og:title'],meta[name='og:title']`\n) as HTMLMetaElement;\nattrs[\"og:title\"] = ogtitleMeta ? ogtitleMeta.content : \"\";\nattrs.session = session || localStorage.getItem(\"utterances-session\") || \"\";\n\n// create the standard utterances styles and insert them at the beginning of the\n// <head> for easy overriding.\n// NOTE: the craziness with \"width\" is for mobile safari :(\ndocument.head.insertAdjacentHTML(\n  \"afterbegin\",\n  `<style>\n    .utterances {\n      position: relative;\n      box-sizing: border-box;\n      width: 100%;\n      max-width: 760px;\n      margin-left: auto;\n      margin-right: auto;\n    }\n    .utterances-frame {\n      color-scheme: light;\n      position: absolute;\n      left: 0;\n      right: 0;\n      width: 1px;\n      min-width: 100%;\n      max-width: 100%;\n      height: 100%;\n      border: 0;\n    }\n  </style>`\n);\n\n// create the comments iframe and it's responsive container\nconst utterancesOrigin = script.src.match(\n  /^https:\\/\\/Jungley8\\.github\\.io\\/utterances|http:\\/\\/localhost:\\d+/i\n)![0];\nconsole.log({ utterancesOrigin });\nconst frameUrl = `${utterancesOrigin}/utterances.html`;\nscript.insertAdjacentHTML(\n  \"afterend\",\n  `<div class=\"utterances\">\n    <iframe class=\"utterances-frame\" title=\"Comments\" scrolling=\"no\" src=\"${frameUrl}?${new URLSearchParams(\n    attrs\n  )}\" loading=\"lazy\"></iframe>\n  </div>`\n);\nconst container = script.nextElementSibling as HTMLDivElement;\nscript.parentElement!.removeChild(script);\n\n// adjust the iframe's height when the height of it's content changes\naddEventListener(\"message\", (event) => {\n  // if (event.origin !== utterancesOrigin) {\n  //   return;\n  // }\n  const data = event.data as ResizeMessage;\n  if (data && data.type === \"resize\" && data.height) {\n    container.style.height = `${data.height}px`;\n  }\n});\n"],"names":["$d7616cc977854c9a$export$62cdbe59b53bcfdb","window","matchMedia","matches","$e5620cd4ca038e6a$var$url","URL","location","href","$e5620cd4ca038e6a$var$session","searchParams","get","localStorage","setItem","delete","history","replaceState","undefined","document","title","$e5620cd4ca038e6a$var$script","currentScript","querySelector","$e5620cd4ca038e6a$var$attrs","i","attributes","length","attribute","item","name","replace","value","theme","$e5620cd4ca038e6a$var$canonicalLink","url","origin","pathname","search","substr","$e5620cd4ca038e6a$var$descriptionMeta","description","content","$e5620cd4ca038e6a$var$len","encodeURIComponent","Math","floor","$e5620cd4ca038e6a$var$ogtitleMeta","session","getItem","head","insertAdjacentHTML","$e5620cd4ca038e6a$var$utterancesOrigin","src","match","console","log","$e5620cd4ca038e6a$var$frameUrl","URLSearchParams","$e5620cd4ca038e6a$var$container","nextElementSibling","parentElement","removeChild","addEventListener","event","data","type","height","style"],"version":3,"file":"client.js.map"}